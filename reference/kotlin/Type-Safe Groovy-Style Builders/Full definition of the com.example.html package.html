<pre><code class="code _highlighted" data-lang="text/x-kotlin">package com.example.html

interface Element {
    fun render(builder: StringBuilder, indent: String)
}

class TextElement(val text: String) : Element {
    override fun render(builder: StringBuilder, indent: String) {
        builder.append(&quot;$indent$text\n&quot;)
    }
}

abstract class Tag(val name: String) : Element {
    val children = arrayListOf&lt;Element&gt;()
    val attributes = hashMapOf&lt;String, String&gt;()

    protected fun &lt;T : Element&gt; initTag(tag: T, init: T.() -&gt; Unit): T {
        tag.init()
        children.add(tag)
        return tag
    }

    override fun render(builder: StringBuilder, indent: String) {
        builder.append(&quot;$indent&lt;$name${renderAttributes()}&gt;\n&quot;)
        for (c in children) {
            c.render(builder, indent + &quot;  &quot;)
        }
        builder.append(&quot;$indent&lt;/$name&gt;\n&quot;)
    }

    private fun renderAttributes(): String {
        val builder = StringBuilder()
        for (a in attributes.keys) {
            builder.append(&quot; $a=\&quot;${attributes[a]}\&quot;&quot;)
        }
        return builder.toString()
    }


    override fun toString(): String {
        val builder = StringBuilder()
        render(builder, &quot;&quot;)
        return builder.toString()
    }
}

abstract class TagWithText(name: String) : Tag(name) {
    operator fun String.unaryPlus() {
        children.add(TextElement(this))
    }
}

class HTML() : TagWithText(&quot;html&quot;) {
    fun head(init: Head.() -&gt; Unit) = initTag(Head(), init)

    fun body(init: Body.() -&gt; Unit) = initTag(Body(), init)
}

class Head() : TagWithText(&quot;head&quot;) {
    fun title(init: Title.() -&gt; Unit) = initTag(Title(), init)
}

class Title() : TagWithText(&quot;title&quot;)

abstract class BodyTag(name: String) : TagWithText(name) {
    fun b(init: B.() -&gt; Unit) = initTag(B(), init)
    fun p(init: P.() -&gt; Unit) = initTag(P(), init)
    fun h1(init: H1.() -&gt; Unit) = initTag(H1(), init)
    fun a(href: String, init: A.() -&gt; Unit) {
        val a = initTag(A(), init)
        a.href = href
    }
}

class Body() : BodyTag(&quot;body&quot;)
class B() : BodyTag(&quot;b&quot;)
class P() : BodyTag(&quot;p&quot;)
class H1() : BodyTag(&quot;h1&quot;)

class A() : BodyTag(&quot;a&quot;) {
    public var href: String
        get() = attributes[&quot;href&quot;]!!
        set(value) {
            attributes[&quot;href&quot;] = value
        }
}

fun html(init: HTML.() -&gt; Unit): HTML {
    val html = HTML()
    html.init()
    return html
}
</code></pre>
